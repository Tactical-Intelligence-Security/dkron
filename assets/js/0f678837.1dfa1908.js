"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1439],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=o.createContext({}),u=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=u(e.components);return o.createElement(i.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},g=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),g=a,m=p["".concat(i,".").concat(g)]||p[g]||c[g]||r;return n?o.createElement(m,s(s({ref:t},d),{},{components:n})):o.createElement(m,s({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=g;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:a,s[1]=l;for(var u=2;u<r;u++)s[u]=n[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}g.displayName="MDXCreateElement"},5851:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var o=n(7462),a=(n(7294),n(3905));const r={title:"Target nodes spec",weight:10},s=void 0,l={unversionedId:"usage/target-nodes-spec",id:"usage/target-nodes-spec",title:"Target nodes spec",description:"Target nodes spec",source:"@site/docs/usage/target-nodes-spec.md",sourceDirName:"usage",slug:"/usage/target-nodes-spec",permalink:"/docs/usage/target-nodes-spec",draft:!1,editUrl:"https://github.com/distribworks/dkron/tree/main/website/docs/docs/usage/target-nodes-spec.md",tags:[],version:"current",frontMatter:{title:"Target nodes spec",weight:10},sidebar:"tutorialSidebar",previous:{title:"Embedded storage",permalink:"/docs/usage/storage"},next:{title:"Upgrade methods",permalink:"/docs/usage/upgrade"}},i={},u=[{value:"Target nodes spec",id:"target-nodes-spec",level:2},{value:"Target all nodes with a tag",id:"target-all-nodes-with-a-tag",level:4},{value:"Target only one nodes of a group of nodes with a tag",id:"target-only-one-nodes-of-a-group-of-nodes-with-a-tag",level:4},{value:"Details and limitations",id:"details-and-limitations",level:3}],d={toc:u};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"target-nodes-spec"},"Target nodes spec"),(0,a.kt)("p",null,"Default is for all nodes to execute each job. Dkron has the ability to run jobs in specific nodes by leveraging the use of tags. You can choose whether a job is run on a node or group of nodes by specifying tags and a count of target nodes having this tag do you want a job to run."),(0,a.kt)("p",null,"The target node syntax is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'"tag": "value[:count]"\n')),(0,a.kt)("p",null,"To achieve this Nodes and Jobs have tags, for example, having a node with the following tags:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "tags": {\n        "dc": "dc1",\n        "expect": "3",\n        "port": "6868",\n        "region": "global",\n        "role": "dkron",\n        "rpc_addr": "10.88.94.129:6868",\n        "server": "true",\n        "version": "devel",\n        "my_role": "web"\n    }\n}\n')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"You can specify tags for nodes in the dkron config file or in the command line using ",(0,a.kt)("inlineCode",{parentName:"p"},"--tags")," parameter")),(0,a.kt)("p",null,"In case there is no matching nodes with the specified tags, the job will not run."),(0,a.kt)("p",null,"Following some examples using different tag combinations:"),(0,a.kt)("h4",{id:"target-all-nodes-with-a-tag"},"Target all nodes with a tag"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "job_name",\n    "command": "/bin/true",\n    "schedule": "@every 2m",\n    "tags": {\n        "my_role": "web"\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mermaid"},'graph LR;\n    J("Job tags: #quot;my_role#quot;: #quot;web#quot;") --\x3e|Run Job|N1["Node1 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J --\x3e|Run Job|N2["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J --\x3e|Run Job|N3["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n')),(0,a.kt)("h4",{id:"target-only-one-nodes-of-a-group-of-nodes-with-a-tag"},"Target only one nodes of a group of nodes with a tag"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "job_name",\n    "command": "/bin/true",\n    "schedule": "@every 2m",\n    "tags": {\n        "my_role": "web:1"\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mermaid"},'graph LR;\n    J("Job tags: #quot;my_role#quot;: #quot;web:1#quot;") --\x3e|Run Job|N1["Node1 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J -.- N2["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J -.- N3["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n')),(0,a.kt)("p",null,"Dkron will try to run the job in the amount of nodes indicated by that count having that tag."),(0,a.kt)("h3",{id:"details-and-limitations"},"Details and limitations"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Tags specified in a Job are combined using ",(0,a.kt)("inlineCode",{parentName:"li"},"AND"),", therefore a job that specifies several tags like:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "tags": {\n        "my_role": "web",\n        "role": "dkron"\n    }\n}\n')),(0,a.kt)("p",null,"Will try to run the job in nodes that have all speciefied tags."),(0,a.kt)("p",null,"There is no limit in the tags that a job can have but having a Job with several tags with count like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "tags": {\n        "my_role": "web:1",\n        "role": "dkron:2"\n    }\n}\n')),(0,a.kt)("p",null,"Will try to run the job in nodes that have all specified tags and using the lowest count. In the last example, it will run in ",(0,a.kt)("strong",{parentName:"p"},"one")," node having ",(0,a.kt)("inlineCode",{parentName:"p"},'"my_role": "web"')," and ",(0,a.kt)("inlineCode",{parentName:"p"},'"role": "dkron"')," tag, even if there is more than one node with these tags."))}p.isMDXComponent=!0}}]);